<p-dialog
  [header]="id ? 'Editar Producto' : 'Crear Producto'"
  [(visible)]="show"
  [modal]="true"
  (onHide)="closeModal.emit()"
  [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
  [style]="{ width: '50vw' }"
  [draggable]="false"
  [resizable]="false"
>
  <ng-container *ngTemplateOutlet="formTemplate"></ng-container>
</p-dialog>

<ng-template #formTemplate>
  <form
    [formGroup]="form"
    class="w-full flex flex-col md:flex-row gap-y-4 justify-between flex-wrap"
  >
    @if (id) {
    <div class="w-full flex justify-end items-center gap-4">
      <label class="font-bold" for="isAvailable"> Disponible </label>
      <p-toggleswitch formControlName="isAvailable" />
    </div>
    }
    <div class="mb-4 w-full md:w-6/12 flex gap-2 items-center">
      <label class="font-bold w-[5rem]" for="name">Nombre</label>
      <div class="w-[calc(100%-6rem)]">
        <input
          pInputText
          formControlName="name"
          class="w-full"
          [invalid]="form.get('name') | formControlError"
        />
        @if(form.get('name') | formControlError) {
        <div class="w-auto relative">
          @if(form.get('name')?.errors?.['minlength']) {
          <p-message class="absolute" severity="error" size="small" variant="simple"
            >Se requiere un mi패nimo de 3 caracteres.</p-message
          >
          } @if(form.get('name')?.errors?.['maxlength']) {
          <p-message class="absolute" severity="error" size="small" variant="simple"
            >Se requiere un ma패ximo de 100 caracteres.</p-message
          >
          } @if (form.get('name')?.errors?.['required']) {
          <p-message class="absolute" severity="error" size="small" variant="simple"
            >El nombre es requerido.</p-message
          >
          }
        </div>
        }
      </div>
    </div>

    <div class="mb-4 w-full md:w-6/12 flex gap-2 items-center">
      <label class="font-bold w-[5rem]" for="category">Categoria</label>
      <div class="w-[calc(100%-6rem)]">
        <p-select
          [options]="service.categories()"
          formControlName="category"
          optionLabel="name"
          optionValue="name"
          class="w-full"
        />
        @if(form.get('category') | formControlError) {
        <div class="w-auto relative">
          <p-message class="absolute" severity="error" size="small" variant="simple"
            >La categori패a es requerida</p-message
          >
        </div>
        }
      </div>
    </div>

    <div class="mb-4 w-full md:w-6/12 flex gap-2 items-center">
      <label class="font-bold w-[5rem]" for="price">Precio</label>
      <div class="w-[calc(100%-6rem)]">
        <p-inputnumber
          formControlName="price"
          class="w-full"
          mode="currency"
          currency="USD"
          locale="en-US"
          [invalid]="form.get('price') | formControlError"
        ></p-inputnumber>

        @if(form.get('price') | formControlError) {
        <div class="w-auto relative">
          <p-message class="absolute" severity="error" size="small" variant="simple"
            >El precio es requerido.</p-message
          >
        </div>
        }
      </div>
    </div>

    <div class="mb-2 w-full md:w-6/12 flex gap-2 items-center">
      <label class="font-bold w-[5rem]" for="stock">En Stock</label>
      <div class="w-[calc(100%-6rem)]">
        <p-inputnumber formControlName="stock" class="w-full"></p-inputnumber>
      </div>
    </div>

    <div class="w-full mb-2">
      <label class="font-bold" for="stock">Descripcio패n</label>
      <textarea
        rows="3"
        cols="30"
        class="w-full"
        formControlName="description"
        pTextarea
        [invalid]="form.get('description') | formControlError"
      ></textarea>
    </div>
  </form>

  <div class="flex justify-center items-center gap-4">
    <p-button
      [disabled]="form.invalid || loading"
      [icon]="loading ? 'pi pi-spin pi-spinner' : ''"
      label="Guardar"
      (click)="saveForm()"
      [raised]="true"
      severity="success"
    />
  </div>
</ng-template>
